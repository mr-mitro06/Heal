<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EcoTrace - Daily Nature Tracker</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f0fdf4; /* Green-50 */
            /* Prevent bounce scrolling on mobile */
            overscroll-behavior-y: none;
        }
        .fade-in {
            animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Hide scrollbar for Chrome, Safari and Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        /* Custom animations */
        .animate-bounce-short {
            animation: bounceShort 0.5s ease-in-out infinite alternate;
        }
        @keyframes bounceShort {
            from { transform: translate(-50%, 0); }
            to { transform: translate(-50%, -4px); }
        }
        .tap-highlight-transparent {
            -webkit-tap-highlight-color: transparent;
        }
    </style>
</head>
<body class="text-slate-800 antialiased h-screen overflow-hidden selection:bg-green-200">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useLayoutEffect } = React;

        // --- Inline Icon Components ---
        
        const Icon = ({ children, size = 24, className = "" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const Leaf = (props) => <Icon {...props}><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></Icon>;
        const Droplet = (props) => <Icon {...props}><path d="M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z"/></Icon>;
        const Wind = (props) => <Icon {...props}><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></Icon>;
        const Zap = (props) => <Icon {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></Icon>;
        const Trash2 = (props) => <Icon {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></Icon>;
        const Smartphone = (props) => <Icon {...props}><rect x="5" y="2" width="14" height="20" rx="2" ry="2"/><line x1="12" y1="18" x2="12.01" y2="18"/></Icon>;
        const Home = (props) => <Icon {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></Icon>;
        const ArrowRight = (props) => <Icon {...props}><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></Icon>;
        const Check = (props) => <Icon {...props}><polyline points="20 6 9 17 4 12"/></Icon>;
        const AlertCircle = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></Icon>;
        const Info = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></Icon>;
        const RefreshCw = (props) => <Icon {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></Icon>;
        const Trophy = (props) => <Icon {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></Icon>;
        const Flame = (props) => <Icon {...props}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.243-2.143.5-3.5 1.072 2.143 1.5 3.5 3 4Z"/></Icon>;
        const Thermometer = (props) => <Icon {...props}><path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"/></Icon>;
        const Minus = (props) => <Icon {...props}><line x1="5" y1="12" x2="19" y2="12"/></Icon>;

        // --- Data & Content ---
        
        // Expanded Avatar List with more female characters
        const avatars = [
            { id: 1, name: 'Leafy', seed: 'Felix', color: 'bg-green-100' },
            { id: 2, name: 'Daisy', seed: 'Willow', color: 'bg-rose-100' }, // Female
            { id: 3, name: 'Aqua', seed: 'Aneka', color: 'bg-blue-100' },
            { id: 4, name: 'Bella', seed: 'Bella', color: 'bg-purple-100' }, // Female
            { id: 5, name: 'Sunny', seed: 'Molly', color: 'bg-yellow-100' }, // Female
            { id: 6, name: 'Terra', seed: 'Oliver', color: 'bg-stone-100' },
            { id: 7, name: 'Bloom', seed: 'Sugar', color: 'bg-pink-100' }, // Female
            { id: 8, name: 'Rocky', seed: 'Boots', color: 'bg-gray-100' },
        ];

        const questions = [
            {
                id: 'bath',
                title: 'Morning Ritual',
                icon: <Droplet className="w-5 h-5 sm:w-6 sm:h-6 text-blue-500" />,
                text: 'How did you bathe today?',
                options: [
                    { label: 'Quick Cold/Bucket Shower', type: 'green', score: 10, feedback: 'Great! Low energy usage.' },
                    { label: 'Short Warm Shower', type: 'yellow', score: 5, feedback: 'Moderate energy used.' },
                    { label: 'Long Hot Shower', type: 'red', score: 0, feedback: 'High energy consumption!' }
                ],
                science: {
                    title: 'Thermodynamics',
                    content: 'Heating water is the #1 energy consumer in a household. A 20-min hot shower uses more electricity than a laptop does in a week.'
                }
            },
            {
                id: 'travel',
                title: 'The Commute',
                icon: <Wind className="w-5 h-5 sm:w-6 sm:h-6 text-teal-500" />,
                text: 'How did you travel to your workplace?',
                options: [
                    { label: 'Walk / Cycle', type: 'green', score: 10, feedback: 'Zero emissions!' },
                    { label: 'Bus / Metro / Shared Auto', type: 'yellow', score: 7, feedback: 'Good efficiency per person.' },
                    { label: 'Personal Car / Bike (Solo)', type: 'red', score: 0, feedback: 'High pollution per head.' }
                ],
                science: {
                    title: 'Combustion Efficiency',
                    content: 'A bus moves 50 people with one engine. A bike moves 1 person with one engine. The per-head pollution on a solo vehicle is massive compared to public transport.'
                }
            },
            {
                id: 'food_container',
                title: 'Food & Packaging',
                icon: <Trash2 className="w-5 h-5 sm:w-6 sm:h-6 text-orange-500" />,
                text: 'Did you order food? If so, how was it served?',
                options: [
                    { label: 'Home Food / Reusable Plate', type: 'green', score: 10, feedback: 'Best choice.' },
                    { label: 'Paper Box / Minimal Packaging', type: 'yellow', score: 5, feedback: 'Better than plastic.' },
                    { label: 'Plastic Container & Cutlery', type: 'red', score: 0, feedback: 'Microplastics & landfill waste.' }
                ],
                science: {
                    title: 'Material Degradation',
                    content: 'Single-use plastics take up to 450 years to decompose. Reusables break the cycle of "extract-make-dispose".'
                }
            },
            {
                id: 'food_waste',
                title: 'Consumption',
                icon: <RefreshCw className="w-5 h-5 sm:w-6 sm:h-6 text-red-500" />,
                text: 'Did you finish your meal or waste food?',
                options: [
                    { label: 'Finished everything', type: 'green', score: 10, feedback: 'Respecting resources.' },
                    { label: 'Threw away some food', type: 'red', score: 0, feedback: 'Wasted energy used to grow food.' }
                ],
                science: {
                    title: 'Supply Chain Loss',
                    content: 'When you waste food, you also waste the water, soil nutrients, and fuel used to produce and transport it.'
                }
            },
            {
                id: 'digital',
                title: 'Digital Footprint',
                icon: <Smartphone className="w-5 h-5 sm:w-6 sm:h-6 text-indigo-500" />,
                text: 'How did you consume media (scrolling/videos)?',
                options: [
                    { label: 'Wi-Fi / Downloaded content', type: 'green', score: 10, feedback: 'Energy efficient.' },
                    { label: '4G/5G Data Streaming', type: 'yellow', score: 5, feedback: 'Higher transmission energy.' },
                    { label: '4K Streaming on Mobile Data', type: 'red', score: 0, feedback: 'Massive server load.' }
                ],
                science: {
                    title: 'Data Transmission',
                    content: '4K video requires massive server cooling. Mobile Data (4G/5G) uses 4x more energy than Wi-Fi to transmit the same file.'
                }
            },
            {
                id: 'plugs',
                title: 'Phantom Power',
                icon: <Zap className="w-5 h-5 sm:w-6 sm:h-6 text-yellow-500" />,
                text: 'Are your plugs switched on with nothing connected?',
                options: [
                    { label: 'No, un-plugged when idle', type: 'green', score: 10, feedback: 'Zero leak.' },
                    { label: 'Yes, switches left on', type: 'red', score: 0, feedback: 'Vampire power drain.' }
                ],
                science: {
                    title: 'Standby Power',
                    content: 'Even when devices are off, "vampire power" from plugged-in chargers and standby modes accounts for 5-10% of residential energy use.'
                }
            },
            {
                id: 'sleep',
                title: 'Night Mode',
                icon: <Home className="w-5 h-5 sm:w-6 sm:h-6 text-purple-500" />,
                text: 'How are you sleeping tonight?',
                options: [
                    { label: 'Fan / Open Windows', type: 'green', score: 10, feedback: 'Natural cooling.' },
                    { label: 'AC at 24°C + Timer', type: 'yellow', score: 5, feedback: 'Optimized cooling.' },
                    { label: 'AC at 18°C All Night', type: 'red', score: 0, feedback: 'Heavy compressor load.' }
                ],
                science: {
                    title: 'Thermal Dynamics',
                    content: 'Every degree you lower your AC below 24°C increases energy consumption by about 6%. 18°C is often unnecessary for comfort and purely wasteful.'
                }
            }
        ];

        // --- Components ---

        const WelcomeScreen = ({ onStart }) => (
            <div className="flex flex-col items-center justify-center h-full text-center p-6 sm:p-8 fade-in">
                <div className="bg-white p-6 sm:p-8 rounded-full shadow-xl mb-6 sm:mb-8 border-4 border-green-100">
                    <div className="hidden sm:block">
                        <Leaf size={72} className="text-green-600" />
                    </div>
                    <div className="block sm:hidden">
                        <Leaf size={56} className="text-green-600" />
                    </div>
                </div>
                <h1 className="text-3xl sm:text-4xl font-extrabold text-green-800 mb-2">EcoTrace</h1>
                <p className="text-green-600 mb-8 max-w-xs text-base sm:text-lg leading-relaxed">Track your daily impact on nature. Small steps create big forests.</p>
                <button 
                    onClick={onStart}
                    className="bg-green-600 text-white px-8 py-3.5 rounded-full text-lg sm:text-xl font-bold shadow-lg shadow-green-200 hover:bg-green-700 active:scale-95 transition transform w-full sm:w-auto tap-highlight-transparent outline-none focus:ring-4 focus:ring-green-200"
                >
                    Get Started
                </button>
            </div>
        );

        const LoginScreen = ({ onLogin }) => {
            const [name, setName] = useState('');
            const [selectedAvatarId, setSelectedAvatarId] = useState(avatars[0].id);
            const scrollContainerRef = useRef(null);
            
            // Loop configuration to create infinite scroll feel
            const REPEATS = 51; // Odd number so the middle set is exactly in the center
            
            const loopedAvatars = useMemo(() => {
                let arr = [];
                for(let i = 0; i < REPEATS; i++) {
                    arr = [...arr, ...avatars];
                }
                // Generate unique keys to prevent React warnings
                return arr.map((av, i) => ({ ...av, uniqueKey: `${av.id}-${i}` }));
            }, []);

            // Scroll to the middle on mount so user can scroll left or right immediately
            useEffect(() => {
                if(scrollContainerRef.current) {
                    const { scrollWidth, clientWidth } = scrollContainerRef.current;
                    // Center the scroll view
                    scrollContainerRef.current.scrollLeft = (scrollWidth - clientWidth) / 2;
                }
            }, []);

            // Center-select logic on scroll
            const handleScroll = () => {
                const container = scrollContainerRef.current;
                if (!container) return;

                const containerCenter = container.scrollLeft + (container.clientWidth / 2);
                let closestId = null;
                let minDiff = Infinity;

                const children = container.children;
                // Optimization: Iterate through children to find closest to center
                for (let i = 0; i < children.length; i++) {
                    const child = children[i];
                    if (child.tagName !== 'BUTTON') continue;

                    const childCenter = child.offsetLeft + (child.offsetWidth / 2);
                    const diff = Math.abs(containerCenter - childCenter);
                    
                    if (diff < minDiff) {
                        minDiff = diff;
                        closestId = parseInt(child.getAttribute('data-id'));
                    } else if (diff > minDiff) {
                        // Optimization: if diff starts increasing, we've passed the closest one
                        break;
                    }
                }

                if (closestId !== null) {
                    setSelectedAvatarId(prev => {
                        if (prev !== closestId) return closestId;
                        return prev;
                    });
                }
            };

            const handleAvatarClick = (id, e) => {
                // Center the selected element in the scroll view which will trigger scroll selection
                e.currentTarget.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
            };

            const handleLogin = () => {
                const avatar = avatars.find(a => a.id === selectedAvatarId);
                if(name && avatar) {
                    onLogin(name, avatar);
                }
            };

            return (
                <div className="flex flex-col h-full items-center justify-center p-6 fade-in w-full">
                    <div className="w-full text-center mb-6 sm:mb-8 mt-4 sm:mt-0">
                        <h2 className="text-2xl sm:text-3xl font-extrabold text-green-900 mb-1 sm:mb-2">Welcome Back!</h2>
                        <p className="text-green-600 text-sm sm:text-base">Choose your eco-guardian</p>
                    </div>

                    {/* Avatar Selection - Infinite Horizontal Scroll Loop with Scroll Detection */}
                    <div className="w-full mb-8">
                        <div 
                            ref={scrollContainerRef}
                            onScroll={handleScroll}
                            className="flex justify-start items-center gap-4 overflow-x-auto py-8 px-4 sm:px-2 no-scrollbar scroll-smooth snap-x snap-mandatory" 
                            style={{WebkitOverflowScrolling: 'touch'}}
                        >
                            {/* Spacer for start of list on mobile */}
                            <div className="w-1 shrink-0 sm:hidden"></div>
                            {loopedAvatars.map((av) => {
                                const isSelected = selectedAvatarId === av.id;
                                return (
                                    <button 
                                        key={av.uniqueKey}
                                        data-id={av.id}
                                        onClick={(e) => handleAvatarClick(av.id, e)}
                                        className={`relative transition-all duration-300 transform flex-shrink-0 rounded-full tap-highlight-transparent outline-none snap-center
                                            ${isSelected 
                                                ? 'scale-110 sm:scale-125 z-10 shadow-xl ring-4 ring-green-500' 
                                                : 'scale-90 opacity-80 hover:opacity-100 hover:scale-100 grayscale hover:grayscale-0'}
                                        `}
                                    >
                                        <div className={`w-20 h-20 sm:w-24 sm:h-24 rounded-full overflow-hidden isolate transform-gpu ${av.color}`}>
                                            <img 
                                                src={`https://api.dicebear.com/9.x/adventurer/svg?seed=${av.seed}`}
                                                alt={av.name}
                                                className="w-full h-full object-cover"
                                                loading="lazy"
                                            />
                                        </div>
                                        {isSelected && (
                                            <div className="absolute -bottom-6 left-1/2 transform -translate-x-1/2 bg-green-600 text-white text-[10px] sm:text-xs px-3 py-1 rounded-full font-bold shadow-sm whitespace-nowrap animate-bounce-short pointer-events-none">
                                                {av.name}
                                            </div>
                                        )}
                                    </button>
                                )
                            })}
                            {/* Spacer for end of list on mobile */}
                            <div className="w-1 shrink-0 sm:hidden"></div>
                        </div>
                    </div>

                    {/* Name Input */}
                    <div className="w-full mb-8 relative max-w-sm">
                        <input 
                            type="text" 
                            value={name}
                            onChange={(e) => setName(e.target.value)}
                            placeholder="Enter your nickname"
                            className="w-full p-4 pl-12 rounded-full border-2 border-green-200 focus:border-green-500 focus:outline-none bg-white/80 backdrop-blur shadow-sm text-lg transition text-center font-bold text-green-900 placeholder-green-300 appearance-none"
                        />
                        <div className="absolute left-5 top-1/2 transform -translate-y-1/2 text-green-400 pointer-events-none">
                           <Icon size={24}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></Icon>
                        </div>
                    </div>

                    <button 
                        onClick={handleLogin}
                        disabled={!name}
                        className={`w-full max-w-sm py-4 rounded-full font-bold text-lg shadow-xl transition transform flex items-center justify-center gap-2 tap-highlight-transparent active:scale-95 outline-none
                            ${(!name) 
                                ? 'bg-gray-200 text-gray-400 cursor-not-allowed' 
                                : 'bg-green-600 text-white hover:bg-green-700 hover:scale-105'}`}
                    >
                        Let's Go <ArrowRight size={20} />
                    </button>
                </div>
            );
        };

        const QuestionCard = ({ question, onAnswer }) => {
            const [showScience, setShowScience] = useState(false);
            const [selectedOption, setSelectedOption] = useState(null);

            const handleSelect = (option) => {
                setSelectedOption(option);
                // Show science fact first
                setShowScience(true);
            };

            const handleNext = () => {
                onAnswer(question.id, selectedOption);
                setShowScience(false);
                setSelectedOption(null);
            };

            return (
                <div className="flex flex-col h-full p-4 sm:p-6 w-full relative fade-in overflow-y-auto">
                    <div className="flex items-center gap-3 mb-4 sm:mb-6">
                        <div className="p-2 sm:p-3 bg-white rounded-xl shadow-sm border border-green-100">
                            {question.icon}
                        </div>
                        <h3 className="text-base sm:text-lg font-bold text-green-900 uppercase tracking-wide opacity-70">{question.title}</h3>
                    </div>

                    <h2 className="text-xl sm:text-2xl font-bold text-gray-800 mb-6 sm:mb-8 leading-tight">{question.text}</h2>

                    <div className="space-y-3 mb-8">
                        {question.options.map((opt, idx) => (
                            <button 
                                key={idx}
                                onClick={() => handleSelect(opt)}
                                className={`w-full p-4 rounded-2xl border-2 text-left transition flex items-center justify-between group tap-highlight-transparent outline-none
                                    ${selectedOption === opt 
                                        ? (opt.type === 'green' ? 'border-green-500 bg-green-50' : opt.type === 'yellow' ? 'border-yellow-500 bg-yellow-50' : 'border-red-500 bg-red-50') 
                                        : 'border-white bg-white hover:border-green-200 shadow-sm active:bg-gray-50'}`}
                            >
                                <span className="font-semibold text-gray-700 text-sm sm:text-base">{opt.label}</span>
                                {selectedOption === opt && <Check size={20} className={opt.type === 'green' ? 'text-green-600' : 'text-gray-600'} />}
                            </button>
                        ))}
                    </div>

                    {/* Hidden Science Modal / Overlay */}
                    {showScience && (
                        <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4 bg-black/30 backdrop-blur-sm transition-all animate-in fade-in duration-200">
                            {/* Mobile Bottom Sheet / Desktop Modal */}
                            <div className="bg-white w-full sm:max-w-md p-6 pb-8 sm:pb-6 rounded-t-3xl sm:rounded-3xl shadow-[0_-10px_40px_-15px_rgba(0,0,0,0.3)] sm:shadow-2xl animate-in slide-in-from-bottom-10 sm:zoom-in-95 duration-300">
                                
                                {/* Drag handle for mobile visual cue */}
                                <div className="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6 sm:hidden"></div>

                                <div className="flex items-center gap-2 mb-3 text-indigo-600">
                                    <Info size={18} />
                                    <span className="text-xs font-bold uppercase tracking-wider">Hidden Science</span>
                                </div>
                                <h4 className="text-lg sm:text-xl font-bold text-gray-900 mb-2">{question.science.title}</h4>
                                <p className="text-gray-600 mb-6 leading-relaxed text-sm sm:text-base">
                                    {question.science.content}
                                </p>
                                
                                <div className={`p-3 rounded-lg mb-6 flex items-center gap-3 text-sm font-medium
                                    ${selectedOption.type === 'green' ? 'bg-green-100 text-green-800' : selectedOption.type === 'yellow' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}`}>
                                    {selectedOption.type === 'green' && <Leaf size={16} />}
                                    {selectedOption.type === 'red' && <AlertCircle size={16} />}
                                    {selectedOption.type === 'yellow' && <Minus size={16} />}
                                    <span className="flex-1">Your choice: {selectedOption.feedback}</span>
                                </div>

                                <button 
                                    onClick={handleNext}
                                    className="w-full bg-green-900 text-white py-4 rounded-xl font-bold hover:bg-green-800 active:scale-[0.98] transition shadow-lg shadow-green-900/20 tap-highlight-transparent outline-none"
                                >
                                    Next Question
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const ResultScreen = ({ user, score, maxScore, redFlags, onReset }) => {
            const percentage = Math.round((score / maxScore) * 100);
            
            // Determine nature level
            let level = { title: "Sapling", msg: "Just starting to grow.", color: "text-green-500" };
            if (percentage > 50) level = { title: "Young Tree", msg: "Growing strong roots!", color: "text-green-600" };
            if (percentage > 80) level = { title: "Dense Forest", msg: "You are a guardian of nature!", color: "text-green-700" };

            // Mock streak
            const streak = 4; // Mocked for UI demo

            return (
                <div className="flex flex-col h-full p-4 sm:p-6 w-full overflow-y-auto fade-in no-scrollbar pb-20 sm:pb-6">
                    
                    {/* Header */}
                    <div className="flex items-center justify-between mb-6">
                        <div className="flex items-center gap-3">
                            <div className={`w-12 h-12 sm:w-14 sm:h-14 rounded-full overflow-hidden isolate transform-gpu shadow-sm ${user.avatar.color} flex-shrink-0`}>
                                <img 
                                    src={`https://api.dicebear.com/9.x/adventurer/svg?seed=${user.avatar.seed}`}
                                    alt={user.avatar.name}
                                    className="w-full h-full object-cover"
                                />
                            </div>
                            <div className="min-w-0">
                                <h2 className="font-bold text-gray-900 text-base sm:text-lg truncate">{user.name}</h2>
                                <p className="text-[10px] sm:text-xs text-green-600 font-bold bg-green-100 px-2 py-0.5 rounded-full inline-block">Daily Report</p>
                            </div>
                        </div>
                        <div className="flex-shrink-0 flex items-center gap-1 bg-orange-100 text-orange-700 px-3 py-1 rounded-full text-xs sm:text-sm font-bold shadow-sm">
                            <Flame size={14} className="sm:w-4 sm:h-4" />
                            {streak} Day Streak
                        </div>
                    </div>

                    {/* Score Card */}
                    <div className="bg-white p-6 rounded-3xl shadow-lg border border-green-100 text-center mb-8 relative overflow-hidden flex-shrink-0">
                        <div className="absolute top-0 left-0 w-full h-2 bg-gray-100">
                            <div className="h-full bg-green-500 transition-all duration-1000" style={{width: `${percentage}%`}}></div>
                        </div>
                        <span className="text-4xl sm:text-5xl font-extrabold text-green-800 block mt-4">{score}</span>
                        <span className="text-xs sm:text-sm text-gray-400 uppercase tracking-widest font-semibold">Points Earned</span>
                        
                        <div className="mt-4 p-3 bg-green-50 rounded-xl inline-block border border-green-100">
                            <span className={`font-bold ${level.color} text-sm sm:text-base`}>{level.title}</span>
                            <p className="text-[10px] sm:text-xs text-gray-500">{level.msg}</p>
                        </div>
                    </div>

                    {/* Red Flags / Improvements */}
                    {redFlags.length > 0 ? (
                        <div className="mb-8 flex-shrink-0">
                            <h3 className="font-bold text-red-800 mb-3 flex items-center gap-2 text-sm sm:text-base">
                                <AlertCircle size={18} />
                                Areas to Heal
                            </h3>
                            <div className="space-y-3">
                                {redFlags.map((flag, idx) => (
                                    <div key={idx} className="bg-white border-l-4 border-red-400 p-4 rounded-r-xl shadow-sm">
                                        <h4 className="font-bold text-gray-800 text-xs sm:text-sm mb-1">{flag.questionTitle}</h4>
                                        <p className="text-xs text-red-600 mb-2 font-medium">Problem: {flag.choiceLabel}</p>
                                        <div className="text-xs sm:text-sm text-gray-600 bg-red-50 p-2 rounded leading-relaxed">
                                            <span className="font-bold text-red-700">Tip:</span> 
                                            {flag.id === 'bath' && " Try a 5-minute song timer for your shower."}
                                            {flag.id === 'travel' && " Carpool with a colleague tomorrow."}
                                            {flag.id === 'food_container' && " Ask the restaurant for 'No Cutlery'."}
                                            {flag.id === 'food_waste' && " Store leftovers in the fridge immediately."}
                                            {flag.id === 'digital' && " Download music instead of streaming video."}
                                            {flag.id === 'plugs' && " Use a power strip to switch off all at once."}
                                            {flag.id === 'sleep' && " Try 24°C with a fan. It's surprisingly cool."}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    ) : (
                        <div className="bg-green-100 p-6 rounded-2xl mb-8 text-center border border-green-200 flex-shrink-0">
                            <Trophy size={48} className="mx-auto text-green-600 mb-2" />
                            <h3 className="font-bold text-green-800">Perfect Green Day!</h3>
                            <p className="text-green-700 text-sm">You maintained your streak perfectly.</p>
                        </div>
                    )}

                    <button 
                        onClick={onReset}
                        className="mt-auto w-full bg-gray-900 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-gray-800 active:scale-[0.98] transition tap-highlight-transparent flex-shrink-0 outline-none"
                    >
                        Track Another Day
                    </button>
                </div>
            );
        };

        // --- Main App Logic ---

        const App = () => {
            const [view, setView] = useState('welcome'); // welcome, login, quiz, result
            const [user, setUser] = useState(null);
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [redFlags, setRedFlags] = useState([]);

            const handleStart = () => setView('login');

            const handleLogin = (name, avatar) => {
                setUser({ name, avatar });
                setView('quiz');
            };

            const handleAnswer = (questionId, option) => {
                // Update score
                setScore(prev => prev + option.score);

                // Check for red flags (bad habits)
                if (option.type === 'red') {
                    const q = questions.find(q => q.id === questionId);
                    setRedFlags(prev => [...prev, { id: questionId, questionTitle: q.title, choiceLabel: option.label }]);
                }

                // Move next or finish
                if (currentQuestionIndex < questions.length - 1) {
                    setCurrentQuestionIndex(prev => prev + 1);
                } else {
                    setView('result');
                }
            };

            const handleReset = () => {
                setScore(0);
                setCurrentQuestionIndex(0);
                setRedFlags([]);
                setView('welcome');
            };

            return (
                // Responsive Container: 
                // Mobile: Full width/height, no rounding, full dvh
                // Desktop/Tablet: Centered, constrained width, rounded corners
                <div className="w-full h-[100dvh] sm:h-[90vh] sm:mt-[5vh] sm:max-w-md md:max-w-lg mx-auto bg-green-50 sm:rounded-[2.5rem] shadow-none sm:shadow-2xl overflow-hidden relative border-0 sm:border border-green-100 flex flex-col transition-all duration-300">
                    {/* Background decorations - slightly adjusted for mobile to not interfere with text */}
                    <div className="absolute top-[-50px] left-[-50px] w-40 h-40 bg-green-200 rounded-full blur-3xl opacity-40 pointer-events-none"></div>
                    <div className="absolute bottom-[-50px] right-[-50px] w-60 h-60 bg-yellow-200 rounded-full blur-3xl opacity-40 pointer-events-none"></div>

                    {view === 'welcome' && <WelcomeScreen onStart={handleStart} />}
                    {view === 'login' && <LoginScreen onLogin={handleLogin} />}
                    {view === 'quiz' && (
                        <div className="h-full flex flex-col">
                            {/* Progress Bar */}
                            <div className="px-6 pt-6 sm:pt-8 flex-shrink-0">
                                <div className="h-1.5 sm:h-2 w-full bg-gray-200 rounded-full overflow-hidden">
                                    <div 
                                        className="h-full bg-green-500 transition-all duration-300"
                                        style={{ width: `${((currentQuestionIndex) / questions.length) * 100}%` }}
                                    ></div>
                                </div>
                            </div>
                            <QuestionCard 
                                question={questions[currentQuestionIndex]} 
                                onAnswer={handleAnswer} 
                            />
                        </div>
                    )}
                    {view === 'result' && user && (
                        <ResultScreen 
                            user={user} 
                            score={score} 
                            maxScore={questions.length * 10} 
                            redFlags={redFlags}
                            onReset={handleReset}
                        />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
